<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MedVoice</title>
</head>
<body>
<script>
  function qs(name){
    const u = new URL(window.location.href);
    return (u.searchParams.get(name) || "").trim();
  }
  function apiBase(){
    const v = (qs("api") || "").replace(/\/+$/,"");
    return v || "http://127.0.0.1:8000";
  }
  const doctor_id = qs("doctor_id");
  const field = qs("field") || "ZTA915ENP7";
  const api = apiBase();

  function go(page){
    const url = `${page}?doctor_id=${encodeURIComponent(doctor_id)}&api=${encodeURIComponent(api)}&field=${encodeURIComponent(field)}`;
    window.location.replace(url);
  }

  (async ()=>{
    if(!doctor_id){
      // Sin doctor_id no se puede operar
      document.body.innerText = "Falta doctor_id en la URL.";
      return;
    }

    try{
      const r = await fetch(`${api}/api/voiceprint/exists?doctor_id=${encodeURIComponent(doctor_id)}`);
      const j = await r.json();
      if(r.ok && j.ok && j.exists === true){
        go("medvoice-transcribe.html");
      }else{
        go("medvoice-setup.html");
      }
    }catch(e){
      // Si el backend no responde, al menos abre transcribe para que el usuario vea el error all√°
      go("medvoice-transcribe.html");
    }
  })();
</script>
</body>
</html>
